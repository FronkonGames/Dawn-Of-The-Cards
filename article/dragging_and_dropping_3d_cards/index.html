<!doctype html><html itemscope itemtype=https://schema.org/WebPage class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://fronkongames.github.io/Dawn-Of-The-Cards/"><meta name=author content="Martin Bustos"><meta name=description content="A devblog about the development of 'Dawn Of The Cards'."><meta name=keywords content="devblog,blog,gamedev,gamedevelopment,indiedev,unity,unity3d,roguelike,deckbuilding,zombie,zombies,dawn,cards"><meta name=generator content="Hugo 0.105.0"><title>Dragging And Dropping 3D Cards üÉè | Dawn Of The Cards - Fronkon Games</title><meta itemprop=name content="Dragging And Dropping 3D Cards üÉè"><meta itemprop=description content="Dragging And Dropping 3D Cards üÉè - A devblog about the development of 'Dawn Of The Cards'."><meta property="og:title" content="Dragging And Dropping 3D Cards üÉè"><meta property="og:description" content="Dragging And Dropping 3D Cards üÉè - A devblog about the development of 'Dawn Of The Cards'."><meta property="og:image" content="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?size=200"><meta property="og:url" content="https://fronkongames.github.io/Dawn-Of-The-Cards/article/dragging_and_dropping_3d_cards/"><meta property="og:site_name" content="Dawn Of The Cards - Fronkon Games"><meta property="og:type" content="article"><link rel=apple-touch-icon sizes=152x152 href=/Dawn-Of-The-Cards/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/Dawn-Of-The-Cards/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/Dawn-Of-The-Cards/favicon-16x16.png><link rel=manifest href=/Dawn-Of-The-Cards/site.webmanifest><link rel=mask-icon href=/Dawn-Of-The-Cards/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><script src=/Dawn-Of-The-Cards/modernizr-simple.js></script>
<link href=/Dawn-Of-The-Cards/article/dragging_and_dropping_3d_cards/ rel=alternate type=application/rss+xml title="Dawn Of The Cards - Fronkon Games"><link href=/Dawn-Of-The-Cards/article/dragging_and_dropping_3d_cards/ rel=feed type=application/rss+xml title="Dawn Of The Cards - Fronkon Games"><link rel=canonical href=https://fronkongames.github.io/Dawn-Of-The-Cards/article/dragging_and_dropping_3d_cards/><link rel=stylesheet href=https://fronkongames.github.io/Dawn-Of-The-Cards/theme.css></head><body class=bilberry-hugo-theme><header style=background-image:url(/Dawn-Of-The-Cards/images/header.png);background-repeat:no-repeat;background-position:50%;width:100%;height:fit-content><div class=container style=height:400px><div class=logo style=margin-top:250px><a href=/Dawn-Of-The-Cards class=logo><img src="https://seccdn.libravatar.org/avatar/23f0a74e9bc0a5eb8500a54f0729e295?d=mm&size=200" alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://fronkongames.github.io/Dawn-Of-The-Cards/article/dragging_and_dropping_3d_cards/><i class="fas fa-fw fa-pencil-alt"></i></a><article class="default article"><div class=content><h1 class=article-title><a href=https://fronkongames.github.io/Dawn-Of-The-Cards/article/dragging_and_dropping_3d_cards/>Dragging And Dropping 3D Cards üÉè</a></h1><div class=meta></div><p><img src=/Dawn-Of-The-Cards/images/dragging_and_dropping_3d_cards/promo.gif alt=Promo title=Promo></p><p>Moving cards, with elegance.</p><p>Now that I have defined <a href=https://fronkongames.github.io/Dawn-Of-The-Cards/article/rendering_a_card/>visually a card</a>, the next thing to do is to move it around the scene.</p><p>To do this we first have to detect the cards. We will do this using the &lsquo;<strong>Raycast</strong>&rsquo; functions, which <strong>fire</strong> rays that when colliding with an object give us information about it.</p><p>Since it is a performance consuming operation, we will use some tricks to optimize it. The first one is that we will create a <a href=https://docs.unity3d.com/Manual/use-layers.html>layer</a> to discard objects that are not involved in the operation. We will named it &lsquo;<strong>DragAndDrop</strong>&rsquo;.</p><p><img src=/Dawn-Of-The-Cards/images/dragging_and_dropping_3d_cards/layers.jpg alt=Layers title=Layers></p><p>We will also limit the ray length to the maximum distance our camera sees, since as a general rule we are not interested in objects we are not going to see. This distance is &lsquo;<strong>Camera.main.farClipPlane</strong>&rsquo;.</p><p>Since the &lsquo;<strong>Raycast</strong>&rsquo; operation is going to be used inside the &lsquo;<strong>Update</strong>&rsquo; loop (it is going to be executed every frame), it is always a good idea to avoid allocating memory if we can avoid it. So we will create a <a href=https://docs.unity3d.com/ScriptReference/Ray.html>Ray</a> and use the function <a href=https://docs.unity3d.com/ScriptReference/Physics.RaycastNonAlloc.html>Physics.RaycastNonAlloc</a>.</p><p>The code to detect the cards would look something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span>  <span style=color:#75715e>// Layer of the objects to be detected.</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>  [SerializeField]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> LayerMask raycastMask;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// How many impacts of the beam we want to obtain.</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> HitsCount = <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Information on the impacts of shooting a ray.</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> RaycastHit[] raycastHits = <span style=color:#66d9ef>new</span> RaycastHit[HitsCount];
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Ray created from the camera to the projection of the mouse coordinates on the scene.</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> Ray mouseRay;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/// &lt;summary&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/// Returns the Transfrom of the object closest to the origin of the beam.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/// &lt;/summary&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/// &lt;returns&gt;Transform or null if there is no impact.&lt;/returns&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> Transform MouseRaycast()
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    Transform hit = <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Fire the ray!</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Physics.RaycastNonAlloc(mouseRay, raycastHits, Camera.main.farClipPlane, raycastMask) &gt; <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// We order the impacts according to distance.</span>
</span></span><span style=display:flex><span>      System.Array.Sort(raycastHits, (x, y) =&gt; x.distance.CompareTo(y.sq));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>// We are only interested in the first one.</span>
</span></span><span style=display:flex><span>      hit = raycastHits[<span style=color:#ae81ff>0</span>].transform;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> hit;
</span></span><span style=display:flex><span>  }  
</span></span></code></pre></div><p>WORK IN PROGRESS</p></div><div class="footer no-tags"></div></article></div><div id=comments-container><script src=https://giscus.app/client.js data-repo=FronkonGames/Dawn-Of-The-Cards data-repo-id=R_kgDOHxLLYA data-category=Devblog data-category-id=DIC_kwDOHxLLYM4CQpcc data-mapping=pathname data-reactions-enabled=1 data-emit-metadata data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script><div id=giscus></div></div></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=https://fronkongames.github.io/Dawn-Of-The-Cards/article/dragging_and_dropping_3d_cards/>Dragging And Dropping 3D Cards üÉè</a></li><li><a href=https://fronkongames.github.io/Dawn-Of-The-Cards/article/rendering_a_card/>Rendering A Card In URP üñåÔ∏è</a></li><li><a href=https://fronkongames.github.io/Dawn-Of-The-Cards/article/making_a_3d_card_in_blender/>Making A 3D Card In Blender üÉè</a></li><li><a href=https://fronkongames.github.io/Dawn-Of-The-Cards/article/hello_everybody/>Hello Everybody! üßü</a></li><li><a href=https://fronkongames.github.io/Dawn-Of-The-Cards/archive/>Archive page</a></li></ul></div><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=https://twitter.com/fronkongames target=_blank><i class="fab fa-twitter"></i></a>
<a href=https://github.com/FronkonGames target=_blank><i class="fab fa-github"></i></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://fronkongames.github.io/ target=_blank>&copy;
2022
by Fronkon Games</a></div><div class=author><a href=https://github.com/Lednerb/bilberry-hugo-theme target=_blank>Bilberry Hugo Theme</a></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-7SGJ6HWLSZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7SGJ6HWLSZ",{anonymize_ip:!1})}</script><script src=https://fronkongames.github.io/Dawn-Of-The-Cards/theme.js></script><div id=activate-algolia-search class=hidden><input type=hidden id=algolia-search-appId value=45CEN6X6AT>
<input type=hidden id=algolia-search-apiKey value=16030625f1a4d0dd3b8aefd794fd4cf1>
<input type=hidden id=algolia-search-indexName value=bilberry-hugo-theme>
<input type=hidden id=algolia-search-noSearchResults value="Nothing found.">
<input type=hidden id=algolia-search-currentLanguageOnly></div></body></html>